<!-- chat/templates/chat/room.html -->
{% extends "chat/layout.html" %} {% block content %}

<link rel="Shortcut icon" href="https://assets.chucknorris.host/img/avatar/chuck-norris.png">
<div style="text-align:center;">
<body>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#conversacion1" role="tab" aria-controls="home" aria-selected="true">1</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#conversacion2" role="tab" aria-controls="profile" aria-selected="false">2</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#conversacion2" role="tab" aria-controls="profile" aria-selected="false">3</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#conversacion4" role="tab" aria-controls="profile" aria-selected="false">4</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#conversacion5" role="tab" aria-controls="profile" aria-selected="false">5</a>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active block" id="conversacion1" role="tabpanel" aria-labelledby="home-tab"></div>
      <div class="tab-pane fade block" id="conversacion2" role="tabpanel" aria-labelledby="profile-tab"></div>
      <div class="tab-pane fade block" id="conversacion3" role="tabpanel" aria-labelledby="profile-tab"></div>
      <div class="tab-pane fade block" id="conversacion4" role="tabpanel" aria-labelledby="profile-tab"></div>
      <div class="tab-pane fade block" id="conversacion5" role="tabpanel" aria-labelledby="profile-tab"></div>
    </div>

    <!---
    <div class="block" id="conversacion1"></div>
    <div class="block" id="conversacion2" style = "display:none;"></div>
    <div class="block" id="conversacion3" style = "display:none;"></div>
    -->
    <div class="row" style = "display:inline-block;">
        <span><input id="chat-message-input" type="text" size="90"/></span>
        <span> <input id="chat-message-submit" type="button" class="btn-success" size="10" value="Send"/></span>
    </div>

    <div class="miClaase">
        Deberias escribir <strong>"Chuck"</strong>
    </div>


</body>
</div>

<script>
    var roomName = {{ room_name_json }};
    var personName = {{ person_name_json }};
    var contador = 0;

    var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/chat/' + roomName + '/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        var nameAuthor = data['name'];
        var time_send = data['time'];


        var codigo = '<div class="rounded-right" id="'+ "mensaje-" + contador + '" style="background-color: #98c1d9; width: 70%; margin: auto;">'				+
				'<div class="nombre" style="background-color: #ee6c4d;">'				+
					'<h4>'+ nameAuthor + '</h4>'	+
				'</div>'							+
				'<div class="contenido">'			+
					'<h2>'+ message +'</h2>'	+
				'</div>'							+
				'<div class="time">'			+
					'<p>'+ time_send +'</p>'	+
				'</div>'							+
			'</div>';
	    $('#conversacion1').append(codigo);
	    contador++;
	    if (contador > 5){
	        var element = contador - 6;
	        $('#mensaje-' + element.toString()).remove();
	    };
	    //$('#conversacion').html('<h1>Hola</h1>');
	    //#document.getElementById('conversacion').innerHTML = '<ol><li>html data</li></ol>';
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function(e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    document.querySelector('#chat-message-submit').onclick = function(e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            "name": personName,
            "message": message,
        }));

        messageInputDom.value = '';
    };

    var request = new XMLHttpRequest();

    request.open('GET', 'https://api.chucknorris.io/jokes/random', true);
    request.onload = function() {
      // Begin accessing JSON data here
      var data = JSON.parse(this.response);

      if (request.status >= 200 && request.status < 400) {
        console.log(data);
      } else {
        console.log('error');
      };
    };
</script>
{% endblock content %}
